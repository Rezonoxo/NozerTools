<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NozerTask - Zaawansowana lista zadań</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-dark: #3a56d4;
            --secondary-color: #3f37c9;
            --accent-color: #4895ef;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --gray-color: #6c757d;
            --success-color: #4cc9f0;
            --warning-color: #f8961e;
            --danger-color: #f94144;
            --completed-color: #38b000;
            
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --card-shadow-hover: 0 10px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        .dark-mode {
            --light-color: #212529;
            --dark-color: #f8f9fa;
            --gray-color: #adb5bd;
            --card-bg: #2b2d42;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            --card-shadow-hover: 0 10px 15px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
            transition: var(--transition);
            min-height: 100vh;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        header h1 span {
            color: var(--accent-color);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        #theme-toggle, #settings-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #theme-toggle:hover, #settings-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .main-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }

        @media (max-width: 992px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }

        /* Sidebar styles */
        .sidebar {
            background-color: var(--light-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            height: fit-content;
            position: sticky;
            top: 100px;
        }

        .sidebar h2 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
        }

        .sidebar-menu {
            list-style: none;
            margin-bottom: 2rem;
        }

        .sidebar-menu li {
            margin-bottom: 0.5rem;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            text-decoration: none;
            color: var(--dark-color);
            border-radius: 8px;
            transition: var(--transition);
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .sidebar-menu a i {
            width: 20px;
            text-align: center;
        }

        .projects-list {
            margin-top: 1.5rem;
        }

        .projects-list h3 {
            font-size: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .projects-list h3 button {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
        }

        .project-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .project-item:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }

        .project-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .add-project {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            color: var(--gray-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .add-project:hover {
            color: var(--primary-color);
        }

        /* Main content styles */
        .content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .task-filters {
            display: flex;
            gap: 1rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: none;
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            cursor: pointer;
            transition: var(--transition);
            white-space: nowrap;
            font-weight: 500;
        }

        .filter-btn:hover, .filter-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        .task-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stats-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--gray-color);
        }

        .stats-item i {
            font-size: 1.1rem;
        }

        .stats-item.completed i {
            color: var(--completed-color);
        }

        .stats-item.pending i {
            color: var(--warning-color);
        }

        .stats-item.total i {
            color: var(--primary-color);
        }

        /* Task input styles */
        .task-input-container {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .task-input {
            width: 100%;
            padding: 1rem 1rem 1rem 3.5rem;
            border-radius: 12px;
            border: 2px solid rgba(67, 97, 238, 0.3);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--light-color);
            color: var(--dark-color);
        }

        .task-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .task-input-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        /* Task list styles */
        .task-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .task-item {
            background-color: var(--light-color);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .task-item:hover {
            box-shadow: var(--card-shadow-hover);
            transform: translateY(-2px);
        }

        .task-item.completed {
            opacity: 0.8;
        }

        .task-checkbox {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--gray-color);
            border-radius: 6px;
            cursor: pointer;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .task-checkbox:checked {
            background-color: var(--completed-color);
            border-color: var(--completed-color);
        }

        .task-checkbox:checked::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            color: white;
            font-size: 0.8rem;
        }

        .task-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .task-title {
            font-weight: 500;
            word-break: break-word;
        }

        .task-item.completed .task-title {
            text-decoration: line-through;
            color: var(--gray-color);
        }

        .task-description {
            font-size: 0.9rem;
            color: var(--gray-color);
            word-break: break-word;
        }

        .task-details {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .task-date, .task-priority, .task-project {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .task-date {
            background-color: rgba(73, 80, 87, 0.1);
            color: var(--gray-color);
        }

        .task-date.overdue {
            background-color: rgba(249, 65, 68, 0.1);
            color: var(--danger-color);
        }

        .task-date.today {
            background-color: rgba(76, 201, 240, 0.1);
            color: var(--success-color);
        }

        .task-priority {
            background-color: rgba(248, 150, 30, 0.1);
            color: var(--warning-color);
        }

        .task-priority.high {
            background-color: rgba(249, 65, 68, 0.1);
            color: var(--danger-color);
        }

        .task-priority.low {
            background-color: rgba(38, 176, 0, 0.1);
            color: var(--completed-color);
        }

        .task-project {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
        }

        .task-actions {
            display: flex;
            gap: 0.5rem;
            margin-left: auto;
            flex-shrink: 0;
        }

        .task-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            background-color: transparent;
            color: var(--gray-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .task-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--dark-color);
        }

        .task-btn.edit:hover {
            color: var(--primary-color);
        }

        .task-btn.delete:hover {
            color: var(--danger-color);
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 3rem 0;
            color: var(--gray-color);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state p {
            margin-bottom: 1.5rem;
        }

        .empty-state-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        .empty-state-btn:hover {
            background-color: var(--primary-dark);
        }

        /* Modal styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background-color: var(--light-color);
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateY(20px);
            transition: transform 0.3s ease;
            position: relative;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-color);
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--danger-color);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            font-size: 1rem;
            transition: var(--transition);
            background-color: var(--light-color);
            color: var(--dark-color);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        .form-row {
            display: flex;
            gap: 1rem;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 2rem;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--dark-color);
        }

        .btn-secondary:hover {
            background-color: rgba(0, 0, 0, 0.1);
        }

        /* Priority selector */
        .priority-selector {
            display: flex;
            gap: 0.5rem;
        }

        .priority-option {
            flex: 1;
            text-align: center;
            padding: 0.75rem;
            border-radius: 8px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .priority-option:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        .priority-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary-color);
            font-weight: 500;
        }

        .priority-option.low.selected {
            border-color: var(--completed-color);
            background-color: rgba(56, 176, 0, 0.1);
            color: var(--completed-color);
        }

        .priority-option.medium.selected {
            border-color: var(--warning-color);
            background-color: rgba(248, 150, 30, 0.1);
            color: var(--warning-color);
        }

        .priority-option.high.selected {
            border-color: var(--danger-color);
            background-color: rgba(249, 65, 68, 0.1);
            color: var(--danger-color);
        }

        /* Project color picker */
        .color-picker {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .color-option.selected {
            border-color: var(--dark-color);
            transform: scale(1.1);
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .header-container {
                padding: 0 1rem;
            }
            
            .main-container {
                padding: 0 1rem;
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                position: static;
                margin-bottom: 1rem;
            }
            
            .task-filters {
                gap: 0.5rem;
            }
            
            .filter-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.9rem;
            }
            
            .task-item {
                padding: 1rem;
            }
            
            .task-actions {
                flex-direction: column;
            }
            
            .modal-content {
                margin: 0 1rem;
            }
        }

        /* Dark mode specific styles */
        .dark-mode .task-input {
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .task-item {
            background-color: var(--card-bg);
        }
        
        .dark-mode .form-control {
            border-color: rgba(255, 255, 255, 0.1);
            background-color: var(--card-bg);
        }
        
        .dark-mode .modal-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .priority-option {
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .priority-option:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .dark-mode .color-option.selected {
            border-color: var(--light-color);
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <h1>Nozer<span>Task</span></h1>
            <div class="header-actions">
                <button id="theme-toggle" aria-label="Przełącz motyw">
                    <i class="fas fa-moon"></i>
                </button>
                <button id="settings-toggle" aria-label="Ustawienia">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <h2><i class="fas fa-list-check"></i> Menu</h2>
            <ul class="sidebar-menu">
                <li><a href="#" class="active"><i class="fas fa-inbox"></i> Wszystkie zadania</a></li>
                <li><a href="#"><i class="fas fa-calendar-day"></i> Dzisiaj</a></li>
                <li><a href="#"><i class="fas fa-calendar-week"></i> Nadchodzące</a></li>
                <li><a href="#"><i class="fas fa-star"></i> Ważne</a></li>
                <li><a href="#"><i class="fas fa-check"></i> Ukończone</a></li>
            </ul>

            <div class="projects-list">
                <h3>
                    <span>Projekty</span>
                    <button id="add-project-btn"><i class="fas fa-plus"></i></button>
                </h3>
                <div id="projects-container">
                    <!-- Projects will be added here dynamically -->
                </div>
                <div class="add-project" id="add-project-input-toggle">
                    <i class="fas fa-plus"></i>
                    <span>Dodaj projekt</span>
                </div>
            </div>
        </aside>

        <main class="content">
            <div class="task-filters">
                <button class="filter-btn active" data-filter="all">Wszystkie</button>
                <button class="filter-btn" data-filter="today">Dzisiaj</button>
                <button class="filter-btn" data-filter="important">Ważne</button>
                <button class="filter-btn" data-filter="completed">Ukończone</button>
                <button class="filter-btn" data-filter="pending">Oczekujące</button>
            </div>

            <div class="task-stats">
                <div class="stats-item completed">
                    <i class="fas fa-check-circle"></i>
                    <span id="completed-count">0 ukończonych</span>
                </div>
                <div class="stats-item pending">
                    <i class="fas fa-clock"></i>
                    <span id="pending-count">0 oczekujących</span>
                </div>
                <div class="stats-item total">
                    <i class="fas fa-tasks"></i>
                    <span id="total-count">0 zadań</span>
                </div>
            </div>

            <div class="task-input-container">
                <i class="fas fa-plus task-input-icon"></i>
                <input type="text" class="task-input" id="task-input" placeholder="Dodaj nowe zadanie...">
            </div>

            <div class="task-list" id="task-list">
                <!-- Tasks will be added here dynamically -->
                <div class="empty-state" id="empty-state">
                    <i class="fas fa-tasks"></i>
                    <h3>Brak zadań</h3>
                    <p>Dodaj nowe zadanie, aby rozpocząć</p>
                    <button class="empty-state-btn" id="add-first-task">Dodaj zadanie</button>
                </div>
            </div>
        </main>
    </div>

    <!-- Task Modal -->
    <div class="modal" id="task-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Dodaj nowe zadanie</h2>
                <button class="modal-close" id="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="task-form">
                    <input type="hidden" id="task-id">
                    <div class="form-group">
                        <label for="task-title">Tytuł zadania</label>
                        <input type="text" class="form-control" id="task-title" required>
                    </div>
                    <div class="form-group">
                        <label for="task-description">Opis (opcjonalny)</label>
                        <textarea class="form-control" id="task-description" rows="3"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="task-date">Termin</label>
                            <input type="date" class="form-control" id="task-date">
                        </div>
                        <div class="form-group">
                            <label>Priorytet</label>
                            <div class="priority-selector">
                                <div class="priority-option low" data-priority="low">Niski</div>
                                <div class="priority-option medium selected" data-priority="medium">Średni</div>
                                <div class="priority-option high" data-priority="high">Wysoki</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Projekt</label>
                        <select class="form-control" id="task-project">
                            <!-- Projects will be added here dynamically -->
                        </select>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancel-task">Anuluj</button>
                        <button type="submit" class="btn btn-primary">Zapisz zadanie</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Project Modal -->
    <div class="modal" id="project-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="project-modal-title">Dodaj nowy projekt</h2>
                <button class="modal-close" id="project-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="project-form">
                    <input type="hidden" id="project-id">
                    <div class="form-group">
                        <label for="project-name">Nazwa projektu</label>
                        <input type="text" class="form-control" id="project-name" required>
                    </div>
                    <div class="form-group">
                        <label>Kolor projektu</label>
                        <div class="color-picker">
                            <div class="color-option selected" style="background-color: #4361ee;" data-color="#4361ee"></div>
                            <div class="color-option" style="background-color: #4895ef;" data-color="#4895ef"></div>
                            <div class="color-option" style="background-color: #3f37c9;" data-color="#3f37c9"></div>
                            <div class="color-option" style="background-color: #4cc9f0;" data-color="#4cc9f0"></div>
                            <div class="color-option" style="background-color: #f8961e;" data-color="#f8961e"></div>
                            <div class="color-option" style="background-color: #f94144;" data-color="#f94144"></div>
                            <div class="color-option" style="background-color: #38b000;" data-color="#38b000"></div>
                            <div class="color-option" style="background-color: #7209b7;" data-color="#7209b7"></div>
                            <div class="color-option" style="background-color: #f72585;" data-color="#f72585"></div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" id="cancel-project">Anuluj</button>
                        <button type="submit" class="btn btn-primary">Zapisz projekt</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
document.addEventListener('DOMContentLoaded', function() {
    // DOM Elements
    const body = document.body;
    const themeToggle = document.getElementById('theme-toggle');
    const taskInput = document.getElementById('task-input');
    const taskList = document.getElementById('task-list');
    const emptyState = document.getElementById('empty-state');
    const addFirstTaskBtn = document.getElementById('add-first-task');
    const filterButtons = document.querySelectorAll('.filter-btn');
    const taskModal = document.getElementById('task-modal');
    const projectModal = document.getElementById('project-modal');
    const taskForm = document.getElementById('task-form');
    const projectForm = document.getElementById('project-form');
    const priorityOptions = document.querySelectorAll('.priority-option');
    const colorOptions = document.querySelectorAll('.color-option');
    const projectsContainer = document.getElementById('projects-container');
    const addProjectBtn = document.getElementById('add-project-btn');
    const addProjectInputToggle = document.getElementById('add-project-input-toggle');
    const taskProjectSelect = document.getElementById('task-project');
    const completedCount = document.getElementById('completed-count');
    const pendingCount = document.getElementById('pending-count');
    const totalCount = document.getElementById('total-count');
    
    // State
    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    let projects = JSON.parse(localStorage.getItem('projects')) || [
        { id: 'default', name: 'Ogólne', color: '#4361ee' }
    ];
    let currentFilter = 'all';
    let currentProjectFilter = null;
    let editingTaskId = null;
    let editingProjectId = null;
    let selectedPriority = 'medium';
    let selectedColor = '#4361ee';

    // Initialize the app
    function init() {
        renderTasks();
        renderProjects();
        updateStats();
        setupEventListeners();
        
        // Check for saved theme preference
        const savedTheme = localStorage.getItem('theme') || 
                         (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        
        if (savedTheme === 'dark') {
            body.classList.add('dark-mode');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        }
    }

    // Set up event listeners
    function setupEventListeners() {
        // Theme toggle
        themeToggle.addEventListener('click', toggleTheme);
        
        // Task input
        taskInput.addEventListener('keypress', handleTaskInput);
        addFirstTaskBtn.addEventListener('click', () => {
            taskModal.classList.add('active');
        });
        
        // Filter buttons
        filterButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                filterButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                renderTasks();
            });
        });
        
        // Task modal
        document.getElementById('modal-close').addEventListener('click', closeTaskModal);
        document.getElementById('cancel-task').addEventListener('click', closeTaskModal);
        taskForm.addEventListener('submit', handleTaskSubmit);
        
        // Priority selection
        priorityOptions.forEach(option => {
            option.addEventListener('click', () => {
                priorityOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedPriority = option.dataset.priority;
            });
        });
        
        // Project modal
        document.getElementById('project-modal-close').addEventListener('click', closeProjectModal);
        document.getElementById('cancel-project').addEventListener('click', closeProjectModal);
        projectForm.addEventListener('submit', handleProjectSubmit);
        
        // Color selection
        colorOptions.forEach(option => {
            option.addEventListener('click', () => {
                colorOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                selectedColor = option.dataset.color;
            });
        });
        
        // Project management
        addProjectBtn.addEventListener('click', openProjectModal);
        addProjectInputToggle.addEventListener('click', openProjectModal);
    }

    // Theme toggle function
    function toggleTheme() {
        body.classList.toggle('dark-mode');
        const theme = body.classList.contains('dark-mode') ? 'dark' : 'light';
        localStorage.setItem('theme', theme);
        
        themeToggle.innerHTML = theme === 'dark' ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    }

    // Handle task input
    function handleTaskInput(e) {
        if (e.key === 'Enter' && taskInput.value.trim() !== '') {
            const newTask = {
                id: Date.now().toString(),
                title: taskInput.value.trim(),
                description: '',
                completed: false,
                important: false,
                date: '',
                priority: 'medium',
                project: 'default',
                createdAt: new Date().toISOString()
            };
            
            tasks.push(newTask);
            saveTasks();
            renderTasks();
            updateStats();
            taskInput.value = '';
        }
    }

    // Render tasks
    function renderTasks() {
        // Filter tasks based on current filter
        let filteredTasks = [...tasks];
        
        if (currentFilter === 'today') {
            const today = new Date().toISOString().split('T')[0];
            filteredTasks = filteredTasks.filter(task => task.date === today);
        } else if (currentFilter === 'important') {
            filteredTasks = filteredTasks.filter(task => task.important);
        } else if (currentFilter === 'completed') {
            filteredTasks = filteredTasks.filter(task => task.completed);
        } else if (currentFilter === 'pending') {
            filteredTasks = filteredTasks.filter(task => !task.completed);
        }
        
        // Filter by project if selected
        if (currentProjectFilter) {
            filteredTasks = filteredTasks.filter(task => task.project === currentProjectFilter);
        }
        
        // Clear task list
        taskList.innerHTML = '';
        
        // Show empty state if no tasks
        if (filteredTasks.length === 0) {
            taskList.appendChild(emptyState);
            emptyState.style.display = 'block';
            return;
        }
        
        emptyState.style.display = 'none';
        
        // Sort tasks (completed last, by date, by priority)
        filteredTasks.sort((a, b) => {
            if (a.completed && !b.completed) return 1;
            if (!a.completed && b.completed) return -1;
            
            // Sort by date (earlier first)
            if (a.date && b.date) {
                return new Date(a.date) - new Date(b.date);
            }
            
            // Sort by priority
            const priorityValues = { high: 3, medium: 2, low: 1 };
            return priorityValues[b.priority] - priorityValues[a.priority];
        });
        
        // Render filtered tasks
        filteredTasks.forEach(task => {
            const taskElement = createTaskElement(task);
            taskList.appendChild(taskElement);
        });
    }

    // Create task element
    function createTaskElement(task) {
        const taskItem = document.createElement('div');
        taskItem.className = `task-item ${task.completed ? 'completed' : ''}`;
        taskItem.dataset.id = task.id;
        
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'task-checkbox';
        checkbox.checked = task.completed;
        checkbox.addEventListener('change', () => toggleTaskCompletion(task.id));
        
        const content = document.createElement('div');
        content.className = 'task-content';
        
        const title = document.createElement('div');
        title.className = 'task-title';
        title.textContent = task.title;
        
        content.appendChild(title);
        
        if (task.description) {
            const description = document.createElement('div');
            description.className = 'task-description';
            description.textContent = task.description;
            content.appendChild(description);
        }
        
        const details = document.createElement('div');
        details.className = 'task-details';
        
        if (task.date) {
            const dateElement = document.createElement('div');
            const today = new Date().toISOString().split('T')[0];
            const isOverdue = !task.completed && task.date < today;
            const isToday = task.date === today;
            
            dateElement.className = `task-date ${isOverdue ? 'overdue' : ''} ${isToday ? 'today' : ''}`;
            dateElement.innerHTML = `<i class="fas fa-calendar-alt"></i> ${formatDate(task.date)}`;
            details.appendChild(dateElement);
        }
        
        const priorityElement = document.createElement('div');
        priorityElement.className = `task-priority ${task.priority}`;
        const priorityIcons = {
            low: 'arrow-down',
            medium: 'equals',
            high: 'arrow-up'
        };
        priorityElement.innerHTML = `<i class="fas fa-${priorityIcons[task.priority]}"></i> ${
            task.priority === 'low' ? 'Niski' : task.priority === 'medium' ? 'Średni' : 'Wysoki'
        }`;
        details.appendChild(priorityElement);
        
        if (task.project !== 'default') {
            const project = projects.find(p => p.id === task.project);
            if (project) {
                const projectElement = document.createElement('div');
                projectElement.className = 'task-project';
                projectElement.innerHTML = `<i class="fas fa-bookmark" style="color: ${project.color}"></i> ${project.name}`;
                details.appendChild(projectElement);
            }
        }
        
        content.appendChild(details);
        
        const actions = document.createElement('div');
        actions.className = 'task-actions';
        
        const editBtn = document.createElement('button');
        editBtn.className = 'task-btn edit';
        editBtn.innerHTML = '<i class="fas fa-edit"></i>';
        editBtn.addEventListener('click', () => openTaskModalForEdit(task.id));
        
        const deleteBtn = document.createElement('button');
        deleteBtn.className = 'task-btn delete';
        deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
        deleteBtn.addEventListener('click', () => deleteTask(task.id));
        
        const importantBtn = document.createElement('button');
        importantBtn.className = 'task-btn';
        importantBtn.innerHTML = task.important ? 
            '<i class="fas fa-star" style="color: var(--warning-color)"></i>' : 
            '<i class="far fa-star"></i>';
        importantBtn.addEventListener('click', () => toggleImportantTask(task.id));
        
        actions.appendChild(editBtn);
        actions.appendChild(importantBtn);
        actions.appendChild(deleteBtn);
        
        taskItem.appendChild(checkbox);
        taskItem.appendChild(content);
        taskItem.appendChild(actions);
        
        return taskItem;
    }

    // Format date
    function formatDate(dateString) {
        const options = { day: 'numeric', month: 'short' };
        return new Date(dateString).toLocaleDateString('pl-PL', options);
    }

    // Toggle task completion
    function toggleTaskCompletion(taskId) {
        const taskIndex = tasks.findIndex(t => t.id === taskId);
        if (taskIndex !== -1) {
            tasks[taskIndex].completed = !tasks[taskIndex].completed;
            saveTasks();
            renderTasks();
            updateStats();
        }
    }

    // Toggle important task
    function toggleImportantTask(taskId) {
        const taskIndex = tasks.findIndex(t => t.id === taskId);
        if (taskIndex !== -1) {
            tasks[taskIndex].important = !tasks[taskIndex].important;
            saveTasks();
            renderTasks();
            updateStats();
        }
    }

    // Delete task
    function deleteTask(taskId) {
        if (confirm('Czy na pewno chcesz usunąć to zadanie?')) {
            tasks = tasks.filter(t => t.id !== taskId);
            saveTasks();
            renderTasks();
            updateStats();
        }
    }

    // Open task modal for edit
    function openTaskModalForEdit(taskId) {
        const task = tasks.find(t => t.id === taskId);
        if (task) {
            document.getElementById('modal-title').textContent = 'Edytuj zadanie';
            document.getElementById('task-id').value = task.id;
            document.getElementById('task-title').value = task.title;
            document.getElementById('task-description').value = task.description;
            document.getElementById('task-date').value = task.date;
            document.getElementById('task-project').value = task.project;
            
            // Set priority
            priorityOptions.forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.priority === task.priority) {
                    option.classList.add('selected');
                }
            });
            selectedPriority = task.priority;
            
            editingTaskId = task.id;
            taskModal.classList.add('active');
        }
    }

    // Close task modal
    function closeTaskModal() {
        taskModal.classList.remove('active');
        setTimeout(() => {
            document.getElementById('modal-title').textContent = 'Dodaj nowe zadanie';
            document.getElementById('task-id').value = '';
            taskForm.reset();
            editingTaskId = null;
            selectedPriority = 'medium';
            priorityOptions.forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.priority === 'medium') {
                    option.classList.add('selected');
                }
            });
        }, 300);
    }

    // Handle task submit
    function handleTaskSubmit(e) {
        e.preventDefault();
        
        const taskTitle = document.getElementById('task-title').value.trim();
        const taskDescription = document.getElementById('task-description').value.trim();
        const taskDate = document.getElementById('task-date').value;
        const taskProject = document.getElementById('task-project').value;
        
        if (!taskTitle) return;
        
        if (editingTaskId) {
            // Edit existing task
            const taskIndex = tasks.findIndex(t => t.id === editingTaskId);
            if (taskIndex !== -1) {
                tasks[taskIndex].title = taskTitle;
                tasks[taskIndex].description = taskDescription;
                tasks[taskIndex].date = taskDate;
                tasks[taskIndex].priority = selectedPriority;
                tasks[taskIndex].project = taskProject;
            }
        } else {
            // Add new task
            const newTask = {
                id: Date.now().toString(),
                title: taskTitle,
                description: taskDescription,
                completed: false,
                important: false,
                date: taskDate,
                priority: selectedPriority,
                project: taskProject,
                createdAt: new Date().toISOString()
            };
            
            tasks.push(newTask);
        }
        
        saveTasks();
        renderTasks();
        updateStats();
        closeTaskModal();
    }

    // Open project modal
    function openProjectModal(projectId = null) {
        if (projectId) {
            const project = projects.find(p => p.id === projectId);
            if (project) {
                document.getElementById('project-modal-title').textContent = 'Edytuj projekt';
                document.getElementById('project-id').value = project.id;
                document.getElementById('project-name').value = project.name;
                
                // Set color
                colorOptions.forEach(option => {
                    option.classList.remove('selected');
                    if (option.dataset.color === project.color) {
                        option.classList.add('selected');
                    }
                });
                selectedColor = project.color;
                
                editingProjectId = project.id;
            }
        } else {
            document.getElementById('project-modal-title').textContent = 'Dodaj nowy projekt';
            document.getElementById('project-id').value = '';
            document.getElementById('project-name').value = '';
            editingProjectId = null;
        }
        
        projectModal.classList.add('active');
    }

    // Close project modal
    function closeProjectModal() {
        projectModal.classList.remove('active');
        setTimeout(() => {
            document.getElementById('project-modal-title').textContent = 'Dodaj nowy projekt';
            document.getElementById('project-id').value = '';
            projectForm.reset();
            editingProjectId = null;
            selectedColor = '#4361ee';
            colorOptions.forEach(option => {
                option.classList.remove('selected');
                if (option.dataset.color === '#4361ee') {
                    option.classList.add('selected');
                }
            });
        }, 300);
    }

    // Handle project submit
    function handleProjectSubmit(e) {
        e.preventDefault();
        
        const projectName = document.getElementById('project-name').value.trim();
        
        if (!projectName) return;
        
        if (editingProjectId) {
            // Edit existing project
            const projectIndex = projects.findIndex(p => p.id === editingProjectId);
            if (projectIndex !== -1) {
                projects[projectIndex].name = projectName;
                projects[projectIndex].color = selectedColor;
            }
        } else {
            // Add new project
            const newProject = {
                id: Date.now().toString(),
                name: projectName,
                color: selectedColor
            };
            
            projects.push(newProject);
        }
        
        saveProjects();
        renderProjects();
        closeProjectModal();
    }

    // Render projects
    function renderProjects() {
        // Clear projects container
        projectsContainer.innerHTML = '';
        
        // Clear project select in task modal
        taskProjectSelect.innerHTML = '';
        
        // Add default project to select
        const defaultOption = document.createElement('option');
        defaultOption.value = 'default';
        defaultOption.textContent = 'Ogólne';
        taskProjectSelect.appendChild(defaultOption);
        
        // Add projects to sidebar and select
        projects.forEach(project => {
            if (project.id !== 'default') {
                // Create sidebar project item
                const projectItem = document.createElement('div');
                projectItem.className = 'project-item';
                projectItem.dataset.id = project.id;
                
                const projectColor = document.createElement('div');
                projectColor.className = 'project-color';
                projectColor.style.backgroundColor = project.color;
                
                const projectName = document.createElement('span');
                projectName.textContent = project.name;
                
                const projectActions = document.createElement('div');
                projectActions.className = 'project-actions';
                projectActions.style.marginLeft = 'auto';
                
                const editBtn = document.createElement('button');
                editBtn.className = 'task-btn edit';
                editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                editBtn.style.padding = '0';
                editBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openProjectModal(project.id);
                });
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'task-btn delete';
                deleteBtn.innerHTML = '<i class="fas fa-trash-alt"></i>';
                deleteBtn.style.padding = '0';
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteProject(project.id);
                });
                
                projectActions.appendChild(editBtn);
                projectActions.appendChild(deleteBtn);
                
                projectItem.appendChild(projectColor);
                projectItem.appendChild(projectName);
                projectItem.appendChild(projectActions);
                
                projectItem.addEventListener('click', () => {
                    currentProjectFilter = project.id;
                    renderTasks();
                    document.querySelectorAll('.sidebar-menu a').forEach(a => a.classList.remove('active'));
                });
                
                projectsContainer.appendChild(projectItem);
                
                // Add to select
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                taskProjectSelect.appendChild(option);
            }
        });
    }

    // Delete project
    function deleteProject(projectId) {
        if (confirm('Czy na pewno chcesz usunąć ten projekt? Wszystkie zadania w tym projekcie zostaną przeniesione do "Ogólne".')) {
            // Move tasks to default project
            tasks.forEach(task => {
                if (task.project === projectId) {
                    task.project = 'default';
                }
            });
            
            // Remove project
            projects = projects.filter(p => p.id !== projectId);
            
            saveProjects();
            saveTasks();
            renderProjects();
            renderTasks();
            
            // Reset project filter if needed
            if (currentProjectFilter === projectId) {
                currentProjectFilter = null;
            }
        }
    }

    // Update stats
    function updateStats() {
        const completedTasks = tasks.filter(task => task.completed).length;
        const pendingTasks = tasks.filter(task => !task.completed).length;
        const totalTasks = tasks.length;
        
        completedCount.textContent = `${completedTasks} ukończonych`;
        pendingCount.textContent = `${pendingTasks} oczekujących`;
        totalCount.textContent = `${totalTasks} zadań`;
    }

    // Save tasks to localStorage
    function saveTasks() {
        localStorage.setItem('tasks', JSON.stringify(tasks));
    }

    // Save projects to localStorage
    function saveProjects() {
        localStorage.setItem('projects', JSON.stringify(projects));
    }

    // Initialize app
    init();
});